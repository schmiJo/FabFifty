import{e as L,r as _,j as N,k as q,c,l as b,a as e,d as h,t as d,f as I,h as a,F as z,g as T,m as S,o as u,n as E,p as A,q as B,u as V,b as H,i as G}from"./X7zgmInz.js";import{_ as D}from"./DlAUqK2U.js";const W={key:0,class:"mb-6 p-4 bg-gradient-to-r from-purple-400/10 to-blue-400/5 backdrop-blur-sm rounded-xl border border-purple-400/30"},K={class:"flex items-center justify-between"},Z={class:"font-semibold text-purple-200 flex items-center"},X={class:"text-sm text-purple-100 mt-1"},J={class:"text-right"},Q={class:"text-xs font-mono text-purple-200"},Y={class:"mb-6"},j={class:"block w-full"},O={key:1,class:"space-y-4"},ee={class:"flex items-center justify-between mb-3"},te={class:"text-sm font-medium text-white truncate flex-1 mr-3 flex items-center"},se={class:"text-xs text-yellow-200 bg-yellow-400/20 px-2 py-1 rounded-full"},oe={class:"w-full bg-gray-700/50 rounded-full h-3 mb-3 overflow-hidden"},le={class:"flex items-center justify-between"},re=["href"],ae={class:"bg-gradient-to-r from-white/10 to-white/5 backdrop-blur-sm rounded-xl p-5 border border-white/20 shadow-lg"},ne={class:"flex items-center justify-between mb-3"},ie={class:"text-sm text-yellow-200 bg-yellow-400/20 px-3 py-1 rounded-full"},de={class:"w-full bg-gray-700/50 rounded-full h-4 overflow-hidden"},ce={key:2,class:"mt-6 p-5 bg-gradient-to-r from-green-400/20 to-emerald-500/10 backdrop-blur-sm rounded-xl border border-green-400/30 shadow-lg"},ue=L({__name:"PhotoUploader",props:{concurrencyLimit:{default:3},uploadPath:{default:"images"},categoryId:{},categoryName:{}},emits:["uploadStart","uploadProgress","uploadComplete","uploadError"],setup(F,{expose:v,emit:g}){const f=F,m=g,o=_([]),x=N(()=>o.value.filter(l=>l.status==="completed").length),y=N(()=>{if(o.value.length===0)return 0;const l=o.value.reduce((s,t)=>s+t.progress,0);return Math.round(l/o.value.length)}),w=N(()=>o.value.length>0&&o.value.every(l=>l.status==="completed"));q(x,l=>{m("uploadProgress",l,o.value.length),w.value&&m("uploadComplete",o.value)});function k(){return Math.random().toString(36).substr(2,9)}async function $(l){const s=l.target,t=Array.from(s.files||[]);if(t.length===0)return;console.log(`🔄 Starting upload for ${t.length} files`),console.log(`📁 Upload path: ${f.uploadPath}`),console.log(`🏷️ Category: ${f.categoryName} (${f.categoryId})`),m("uploadStart",t);const i=t.map(r=>({id:k(),fileName:r.name,file:r,progress:0,status:"waiting"}));o.value=[...o.value,...i];const n=[];for(let r=0;r<i.length;r+=f.concurrencyLimit)n.push(i.slice(r,r+f.concurrencyLimit));for(const r of n)await Promise.all(r.map(p=>U(p)));s.value=""}async function U(l){try{const s=o.value.findIndex(i=>i.id===l.id);s!==-1&&(o.value[s].status="uploading",o.value[s].progress=10),console.log("🔄 Starting upload for file:",l.fileName);const t=await $fetch("/api/upload-url",{method:"POST",body:{fileName:l.fileName,fileType:l.file.type,path:f.uploadPath}});s!==-1&&(o.value[s].progress=30),console.log("📋 Got signed URL response:",t),await C(l,t)}catch(s){console.error("❌ Upload failed for file:",l.fileName,s);const t=o.value.findIndex(i=>i.id===l.id);t!==-1&&(o.value[t].status="error",o.value[t].error=s instanceof Error?s.message:"Upload failed"),m("uploadError",`Failed to upload ${l.fileName}: ${s instanceof Error?s.message:"Upload failed"}`)}}function C(l,s){return new Promise((t,i)=>{const n=new XMLHttpRequest;n.upload.addEventListener("progress",r=>{if(r.lengthComputable){const M=30+Math.round(r.loaded/r.total*70),P=o.value.findIndex(R=>R.id===l.id);P!==-1&&(o.value[P].progress=M)}}),n.addEventListener("load",async()=>{const r=o.value.findIndex(p=>p.id===l.id);n.status===200?(r!==-1&&(o.value[r].progress=100,o.value[r].status="completed",o.value[r].publicUrl=s.publicUrl),console.log("✅ Upload successful for:",l.fileName),console.log("🔗 File available at:",s.publicUrl),setTimeout(async()=>{try{const p=await fetch(s.publicUrl,{method:"HEAD"});console.log(`🧪 File accessibility test for ${l.fileName}:`,p.status===200?"✅ ACCESSIBLE":"❌ NOT ACCESSIBLE")}catch(p){console.error(`🧪 File accessibility test failed for ${l.fileName}:`,p)}},2e3),t()):(console.error("❌ Upload failed with status:",n.status),r!==-1&&(o.value[r].status="error",o.value[r].error=`Upload failed with status: ${n.status}`),i(new Error(`Upload failed with status: ${n.status}`)))}),n.addEventListener("error",()=>{console.error("❌ Upload error for file:",l.fileName);const r=o.value.findIndex(p=>p.id===l.id);r!==-1&&(o.value[r].status="error",o.value[r].error="Network error during upload"),i(new Error("Network error during upload"))}),n.open("PUT",s.url),n.setRequestHeader("Content-Type",l.file.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(l.file)})}return v({clearUploads:()=>{o.value=[]},getUploads:()=>o.value,getCompletedUploads:()=>o.value.filter(l=>l.status==="completed")}),(l,s)=>(u(),c("div",null,[l.categoryName?(u(),c("div",W,[e("div",K,[e("div",null,[e("h3",Z,[s[0]||(s[0]=e("i",{class:"fas fa-tag text-purple-300 mr-2"},null,-1)),h(" "+d(l.categoryName),1)]),e("p",X,d(l.uploadPath),1)]),e("div",J,[s[1]||(s[1]=e("p",{class:"text-xs text-purple-300"},"Kategorie-ID:",-1)),e("p",Q,d(l.categoryId),1)])])])):b("",!0),e("div",Y,[e("label",j,[s[2]||(s[2]=I('<div class="border-2 border-dashed border-yellow-400/50 bg-gradient-to-r from-yellow-400/5 to-yellow-600/10 backdrop-blur-sm rounded-2xl p-8 text-center cursor-pointer hover:border-yellow-400 hover:bg-gradient-to-r hover:from-yellow-400/10 hover:to-yellow-600/15 transition-all duration-300 transform hover:scale-[1.02]"><div class="text-yellow-200 mb-3"><i class="fas fa-cloud-upload-alt text-5xl text-yellow-400 mb-4 block"></i><p class="text-lg font-medium">Fotos auswählen</p><p class="text-sm text-yellow-100 mt-2">Mehrere Fotos werden unterstützt</p><p class="text-xs text-yellow-300 mt-1"><i class="fas fa-magic mr-1"></i> Deine Erinnerungen warten darauf geteilt zu werden </p></div></div>',1)),e("input",{type:"file",multiple:"",accept:"image/*",onChange:$,class:"hidden"},null,32)])]),a(o).length>0?(u(),c("div",O,[s[8]||(s[8]=e("h2",{class:"text-xl font-semibold text-white mb-4 flex items-center"},[e("i",{class:"fas fa-tasks text-yellow-400 mr-3"}),h(" Upload-Fortschritt ")],-1)),(u(!0),c(z,null,T(a(o),t=>(u(),c("div",{key:t.id,class:"bg-gradient-to-r from-white/10 to-white/5 backdrop-blur-sm rounded-xl p-4 border border-white/20 shadow-lg"},[e("div",ee,[e("span",te,[s[3]||(s[3]=e("i",{class:"fas fa-image text-yellow-400 mr-2"},null,-1)),h(" "+d(t.fileName),1)]),e("span",se,d(t.progress)+"% ",1)]),e("div",oe,[e("div",{class:"bg-gradient-to-r from-yellow-400 to-yellow-500 h-3 rounded-full transition-all duration-500 relative",style:S({width:t.progress+"%"})},s[4]||(s[4]=[e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-pulse"},null,-1)]),4)]),e("div",le,[e("span",{class:E(["text-sm flex items-center",{"text-blue-300":t.status==="uploading","text-green-300":t.status==="completed","text-red-300":t.status==="error","text-gray-300":t.status==="waiting"}])},[e("i",{class:E(["mr-2",{"fas fa-spinner fa-spin":t.status==="uploading","fas fa-check-circle":t.status==="completed","fas fa-exclamation-circle":t.status==="error","fas fa-clock":t.status==="waiting"}])},null,2),h(" "+d(t.status==="uploading"?"Wird hochgeladen...":t.status==="completed"?"Erfolgreich!":t.status==="error"?"Fehler aufgetreten":"Wartet..."),1)],2),t.status==="completed"&&t.publicUrl?(u(),c("a",{key:0,href:t.publicUrl,target:"_blank",class:"text-sm text-yellow-300 hover:text-yellow-200 underline flex items-center transition-colors"},s[5]||(s[5]=[e("i",{class:"fas fa-external-link-alt mr-1"},null,-1),h(" Ansehen ")]),8,re)):b("",!0)])]))),128)),e("div",ae,[e("div",ne,[s[6]||(s[6]=e("span",{class:"text-lg font-semibold text-white flex items-center"},[e("i",{class:"fas fa-chart-line text-yellow-400 mr-3"}),h(" Gesamtfortschritt ")],-1)),e("span",ie,d(a(x))+"/"+d(a(o).length),1)]),e("div",de,[e("div",{class:"bg-gradient-to-r from-green-400 to-emerald-500 h-4 rounded-full transition-all duration-700 relative",style:S({width:a(y)+"%"})},s[7]||(s[7]=[e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent animate-pulse"},null,-1)]),4)])])])):b("",!0),a(w)&&a(o).length>0?(u(),c("div",ce,s[9]||(s[9]=[I('<div class="flex items-center"><div class="flex-shrink-0"><i class="fas fa-party-horn text-3xl text-green-400 mr-4"></i></div><div><p class="text-lg font-semibold text-green-200 mb-1"> 🎉 Fantastisch! Alle Fotos hochgeladen! </p><p class="text-sm text-green-100"> Deine Erinnerungen sind jetzt Teil der Fab Fifty Galerie </p></div></div>',1)]))):b("",!0)]))}}),fe={class:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 relative overflow-hidden"},pe={class:"relative z-10 p-6 max-w-md mx-auto"},me={class:"mb-6"},ge={class:"text-center bg-gradient-to-r from-white/10 to-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/20 shadow-xl mb-6"},he={class:"mb-4"},xe={class:"text-2xl font-bold text-white mb-3 font-playfair"},be={class:"mb-6 p-4 bg-gradient-to-r from-yellow-400/10 to-yellow-600/5 backdrop-blur-sm rounded-xl border border-yellow-400/30"},ve={class:"text-sm"},ye={class:"text-yellow-100 ml-2 font-mono"},we={key:0,class:"mt-6 p-5 bg-gradient-to-r from-green-400/10 to-emerald-600/5 backdrop-blur-sm rounded-xl border border-green-400/30"},_e={class:"space-y-2"},ke={class:"text-sm text-green-100 flex justify-between"},$e={class:"font-semibold"},Ue={class:"text-sm text-green-100 flex justify-between"},Ce={class:"font-semibold text-green-300"},Ne={key:0,class:"text-sm text-red-200 flex justify-between"},Ie={class:"font-semibold text-red-300"},Ee={key:1,class:"mt-4 space-y-3"},Fe={class:"flex items-start"},Pe={class:"text-sm text-red-200"},Se=L({__name:"[id]",setup(F){const v=A(),g=v.params.id,f=v.query.path||`images/${g}`,m=v.query.name||g;if(!g)throw B({statusCode:404,statusMessage:"Category not found"});const o=_(0),x=_(0),y=_([]);function w(s){return{"bester-teller-buffet":"fas fa-utensils","coolster-tanzschritt":"fas fa-music","dresscode-nicht-erfuellt":"fas fa-tshirt","kreativster-schnappschuss":"fas fa-camera-retro","lieblingsbild-geburtstagskinder":"fas fa-heart","most-impressive-dress":"fas fa-crown","pose-ohne-absicht":"fas fa-laugh","romantischster-moment":"fas fa-kiss","schoenstes-gruppenfoto":"fas fa-users"}[s]||"fas fa-camera"}function k(s){console.log(`📤 Upload started for ${s.length} files`),o.value+=s.length}function $(s,t){console.log(`📈 Upload progress: ${s}/${t}`)}function U(s){const t=s.filter(i=>i.status==="completed").length;x.value+=t,console.log(`✅ Upload batch completed: ${t} successful uploads`)}function C(s){y.value.push(s),console.error(`❌ Upload error: ${s}`)}function l(){G(`/gallery/${g}?path=${encodeURIComponent(f)}&name=${encodeURIComponent(m)}`)}return V({title:`Upload - ${m} | Fab Fifty`}),(s,t)=>{const i=ue;return u(),c("div",fe,[t[8]||(t[8]=I('<div class="absolute inset-0 overflow-hidden" data-v-1446e746><div class="absolute top-10 left-10 w-2 h-2 bg-yellow-400 rounded-full animate-pulse" data-v-1446e746></div><div class="absolute top-20 right-20 w-1 h-1 bg-pink-400 rounded-full animate-ping" data-v-1446e746></div><div class="absolute bottom-32 left-20 w-3 h-3 bg-yellow-300 rounded-full animate-bounce" data-v-1446e746></div><div class="absolute bottom-20 right-10 w-2 h-2 bg-purple-400 rounded-full animate-pulse" data-v-1446e746></div></div>',1)),e("div",pe,[e("div",me,[e("button",{onClick:l,class:"flex items-center text-yellow-300 hover:text-yellow-200 transition-colors mb-6 bg-white/10 backdrop-blur-sm rounded-xl px-4 py-3 border border-white/20 hover:border-yellow-400/50"},t[0]||(t[0]=[e("i",{class:"fas fa-arrow-left mr-3 text-lg"},null,-1),e("span",{class:"font-medium"},"Zurück zur Galerie",-1)])),e("div",ge,[e("div",he,[e("i",{class:E([w(a(g)),"text-4xl text-yellow-400 mb-3 block"])},null,2)]),e("h1",xe,d(a(m)),1),t[1]||(t[1]=e("p",{class:"text-yellow-200 text-sm"},"Lade deine schönsten Fotos für diese Kategorie hoch",-1))])]),e("div",be,[e("div",ve,[t[2]||(t[2]=e("span",{class:"font-medium text-yellow-200"},[e("i",{class:"fas fa-folder text-yellow-400 mr-2"}),h(" Upload-Ziel: ")],-1)),e("span",ye,d(a(f)),1)])]),H(i,{"concurrency-limit":3,"upload-path":a(f),"category-id":a(g),"category-name":a(m),onUploadStart:k,onUploadProgress:$,onUploadComplete:U,onUploadError:C},null,8,["upload-path","category-id","category-name"]),a(o)>0?(u(),c("div",we,[t[6]||(t[6]=e("h3",{class:"text-lg font-semibold text-green-200 mb-4 flex items-center"},[e("i",{class:"fas fa-chart-bar text-green-400 mr-3"}),h(" Session-Übersicht ")],-1)),e("div",_e,[e("p",ke,[t[3]||(t[3]=e("span",null,"Verarbeitete Dateien:",-1)),e("span",$e,d(a(o)),1)]),e("p",Ue,[t[4]||(t[4]=e("span",null,"Erfolgreich hochgeladen:",-1)),e("span",Ce,d(a(x)),1)]),a(o)-a(x)>0?(u(),c("p",Ne,[t[5]||(t[5]=e("span",null,"Fehlgeschlagen:",-1)),e("span",Ie,d(a(o)-a(x)),1)])):b("",!0)])])):b("",!0),a(y).length>0?(u(),c("div",Ee,[(u(!0),c(z,null,T(a(y),(n,r)=>(u(),c("div",{key:r,class:"p-4 bg-gradient-to-r from-red-400/10 to-red-600/5 backdrop-blur-sm rounded-xl border border-red-400/30"},[e("div",Fe,[t[7]||(t[7]=e("i",{class:"fas fa-exclamation-triangle text-red-400 mr-3 mt-1 flex-shrink-0"},null,-1)),e("p",Pe,d(n),1)])]))),128))])):b("",!0)])])}}}),Te=D(Se,[["__scopeId","data-v-1446e746"]]);export{Te as default};
